# üõ†Ô∏è Guia de Desenvolvimento

## üîß Configura√ß√£o do Ambiente

### 1. Vari√°veis de Ambiente

Crie um arquivo `.env` baseado no `env.example`:

```env
# API Configuration
REACT_APP_API_URL=https://solidtechsolutions.com.br/api

# Environment
REACT_APP_ENV=development

# Feature Flags
REACT_APP_ENABLE_REGISTRATION=true
REACT_APP_ENABLE_DARK_MODE=true
REACT_APP_ENABLE_DEBT_SYSTEM=true

# Debug Mode
REACT_APP_DEBUG=true
```

### 2. Backend Necess√°rio

O frontend espera um backend com as seguintes caracter√≠sticas:

#### Estrutura de Resposta Padr√£o
```json
{
  "success": boolean,
  "message": "string",
  "data": object,
  "errors": object
}
```

#### Headers Necess√°rios
```http
Content-Type: application/json
Authorization: Bearer {token}  // Para rotas protegidas
```

## üîê Autentica√ß√£o

### Fluxo de Autentica√ß√£o

1. **Login/Registro**
   - Frontend envia credenciais
   - Backend retorna token JWT
   - Frontend armazena token no localStorage

2. **Requests Autenticados**
   - Frontend inclui header `Authorization: Bearer {token}`
   - Backend valida token
   - Se inv√°lido, retorna 401

3. **Logout**
   - Frontend remove token do localStorage
   - Backend invalida token (opcional)

### Implementa√ß√£o no Frontend

```typescript
// AuthContext.tsx
const login = async (credentials: LoginCredentials) => {
  const response = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(credentials)
  });
  
  const data = await response.json();
  
  if (data.success) {
    localStorage.setItem('authToken', data.data.token);
    // Atualizar estado
  }
};
```

## üí∞ Integra√ß√£o Financeira

### 1. Listar Transa√ß√µes

**Frontend Request:**
```typescript
const fetchTransactions = async (month: string) => {
  const token = localStorage.getItem('authToken');
  
  const response = await fetch(`/api/finance/transactions?month=${month}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  return response.json();
};
```

**Backend Response Esperado:**
```json
{
  "success": true,
  "data": {
    "transactions": [
      {
        "id": "1",
        "description": "Supermercado",
        "amount": 150.50,
        "type": "expense",
        "category": "alimentacao",
        "date": "2024-01-15T10:30:00Z",
        "isRecurring": false,
        "installments": null,
        "totalInstallments": null,
        "currentInstallment": null,
        "dueDate": null
      }
    ]
  }
}
```

### 2. Criar Transa√ß√£o

**Frontend Request:**
```typescript
const createTransaction = async (transaction: Transaction) => {
  const token = localStorage.getItem('authToken');
  
  const response = await fetch('/api/finance/transactions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify(transaction)
  });
  
  return response.json();
};
```

### 3. Resumo Mensal

**Frontend Request:**
```typescript
const fetchSummary = async (month: string) => {
  const token = localStorage.getItem('authToken');
  
  const response = await fetch(`/api/finance/summary?month=${month}`, {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  return response.json();
};
```

## üë• Integra√ß√£o de D√≠vidas

### 1. Listar Pessoas

**Frontend Request:**
```typescript
const fetchPeople = async () => {
  const token = localStorage.getItem('authToken');
  
  const response = await fetch('/api/debts/people', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  return response.json();
};
```

### 2. Criar D√≠vida

**Frontend Request:**
```typescript
const createDebt = async (debt: Debt) => {
  const token = localStorage.getItem('authToken');
  
  const response = await fetch('/api/debts', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify(debt)
  });
  
  return response.json();
};
```

## üîÑ Navega√ß√£o por Meses

### Funcionalidade Implementada

O sistema agora suporta **recarregamento autom√°tico de dados** quando o usu√°rio troca de m√™s nos pain√©is de finan√ßas e d√≠vidas.

### Implementa√ß√£o nos Contextos

#### FinancialContext
```typescript
// Monitora mudan√ßas no currentMonth
useEffect(() => {
  if (isInitialized.current) {
    loadTransactions(state.currentMonth);
  }
}, [state.currentMonth, loadTransactions]);
```

#### DebtContext
```typescript
// Monitora mudan√ßas no currentMonth
useEffect(() => {
  if (isInitialized.current) {
    loadDebts(state.currentMonth);
  }
}, [state.currentMonth, loadDebts]);
```

### Fluxo de Funcionamento

1. **Usu√°rio clica em um m√™s diferente**
2. **MonthlyTabs/DebtMonthlyTabs** dispara `SET_CURRENT_MONTH`
3. **Contexto atualiza** `state.currentMonth`
4. **useEffect detecta** a mudan√ßa no `currentMonth`
5. **Request autom√°tico** √© feito para a API com o novo m√™s
6. **Dados s√£o atualizados** e a interface √© re-renderizada

### Endpoints Utilizados

- **Finan√ßas**: `GET /finance/transactions?month=YYYY-MM`
- **D√≠vidas**: `GET /debts?month=YYYY-MM`

### Benef√≠cios

- ‚úÖ **UX Melhorada**: Dados sempre atualizados
- ‚úÖ **Performance**: Requests apenas quando necess√°rio
- ‚úÖ **Consist√™ncia**: Mesmo comportamento em ambos os pain√©is
- ‚úÖ **Manutenibilidade**: L√≥gica centralizada nos contextos

## üîÑ Estados de Loading

### Implementa√ß√£o

```typescript
// Context
const [isLoading, setIsLoading] = useState(false);

// Component
const handleSubmit = async () => {
  setIsLoading(true);
  try {
    await apiCall();
  } finally {
    setIsLoading(false);
  }
};
```

### UI Feedback

```tsx
<button 
  className={`btn btn-primary ${isLoading ? 'loading' : ''}`}
  disabled={isLoading}
>
  {isLoading ? 'Salvando...' : 'Salvar'}
</button>
```

## üö® Tratamento de Erros

### 1. Erros de Rede

```typescript
const handleApiCall = async () => {
  try {
    const response = await fetch('/api/endpoint');
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('API Error:', error);
    // Mostrar alerta para o usu√°rio
  }
};
```

### 2. Erros de Valida√ß√£o

```typescript
// Backend retorna
{
  "success": false,
  "message": "Dados inv√°lidos",
  "errors": {
    "email": ["Email j√° est√° em uso"],
    "password": ["Senha deve ter pelo menos 6 caracteres"]
  }
}

// Frontend processa
const handleError = (error: any) => {
  if (error.errors) {
    // Mostrar erros espec√≠ficos por campo
    setFieldErrors(error.errors);
  } else {
    // Mostrar erro geral
    setGeneralError(error.message);
  }
};
```

### 3. Token Expirado

```typescript
// Interceptor para requests
const apiRequest = async (url: string, options: RequestInit) => {
  const token = localStorage.getItem('authToken');
  
  const response = await fetch(url, {
    ...options,
    headers: {
      ...options.headers,
      'Authorization': `Bearer ${token}`
    }
  });
  
  if (response.status === 401) {
    // Token expirado
    localStorage.removeItem('authToken');
    window.location.href = '/login';
    return;
  }
  
  return response;
};
```

## üìä Configura√ß√µes

### 1. Categorias

**Frontend Request:**
```typescript
const fetchCategories = async () => {
  const response = await fetch('/api/config/categories');
  return response.json();
};
```

**Backend Response:**
```json
{
  "success": true,
  "data": {
    "categories": [
      {
        "id": "alimentacao",
        "name": "Alimenta√ß√£o",
        "icon": "üçΩÔ∏è",
        "color": "#FF6B6B"
      }
    ]
  }
}
```

### 2. Relacionamentos

**Frontend Request:**
```typescript
const fetchRelationships = async () => {
  const response = await fetch('/api/config/relationships');
  return response.json();
};
```

## üîß Debug e Desenvolvimento

### 1. Logs de Debug

```typescript
// Habilitar logs detalhados
if (process.env.REACT_APP_DEBUG === 'true') {
  console.log('API Request:', { url, data });
  console.log('API Response:', response);
}
```

### 2. Mock Data para Desenvolvimento

```typescript
// Em desenvolvimento, usar dados mock se API n√£o estiver dispon√≠vel
const useMockData = process.env.REACT_APP_ENV === 'development' && !process.env.REACT_APP_API_URL;

if (useMockData) {
  // Retornar dados mock
  return mockData;
}
```

### 3. CORS em Desenvolvimento

**Backend deve configurar CORS:**
```javascript
app.use(cors({
  origin: 'http://localhost:3000',
  credentials: true
}));
```

## üß™ Testes

### 1. Testes de API

```typescript
// __tests__/api.test.ts
describe('API Integration', () => {
  test('should login successfully', async () => {
    const response = await fetch('/api/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: 'test@example.com',
        password: 'password123'
      })
    });
    
    expect(response.status).toBe(200);
    const data = await response.json();
    expect(data.success).toBe(true);
  });
});
```

### 2. Testes de Componentes

```typescript
// __tests__/LoginForm.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import LoginForm from '../components/auth/LoginForm';

test('should show validation errors', () => {
  render(<LoginForm />);
  
  const submitButton = screen.getByText('Entrar');
  fireEvent.click(submitButton);
  
  expect(screen.getByText('Email √© obrigat√≥rio')).toBeInTheDocument();
});
```

## üöÄ Deploy

### 1. Build de Produ√ß√£o

```bash
npm run build
```

### 2. Vari√°veis de Produ√ß√£o

```env
REACT_APP_API_URL=https://api.seudominio.com/api
REACT_APP_ENV=production
REACT_APP_DEBUG=false
```

### 3. Configura√ß√£o do Servidor

**Nginx:**
```nginx
location / {
  try_files $uri $uri/ /index.html;
}
```

**Apache (.htaccess):**
```apache
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [QSA,L]
```

## üìà Monitoramento

### 1. Error Tracking

```typescript
// Sentry integration
import * as Sentry from '@sentry/react';

Sentry.init({
  dsn: process.env.REACT_APP_SENTRY_DSN,
  environment: process.env.REACT_APP_ENV
});
```

### 2. Analytics

```typescript
// Google Analytics
import ReactGA from 'react-ga';

ReactGA.initialize(process.env.REACT_APP_GOOGLE_ANALYTICS_ID);
```

## üîÑ Atualiza√ß√µes

### 1. Migra√ß√£o de Dados

Quando a API mudar, atualize os tipos:

```typescript
// types/index.ts
export interface Transaction {
  id: string;
  description: string;
  amount: number;
  type: 'income' | 'expense';
  category: string;
  date: string;
  // Novos campos adicionados aqui
}
```

### 2. Versionamento da API

```typescript
// Usar versionamento na URL
const API_BASE_URL = `${process.env.REACT_APP_API_URL}/v1`;
```

---

**Este guia deve ser atualizado conforme o projeto evolui!** 